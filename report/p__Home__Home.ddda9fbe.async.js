(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[7],{INpf:function(e,t,a){e.exports={content:"antd-pro-pages-home-home-content",line:"antd-pro-pages-home-home-line",item:"antd-pro-pages-home-home-item"}},Odl4:function(e,t,a){e.exports={line:"antd-pro-components-percentage-item-index-line",item:"antd-pro-components-percentage-item-index-item",addBtn:"antd-pro-components-percentage-item-index-addBtn",removeBtn:"antd-pro-components-percentage-item-index-removeBtn"}},a97E:function(e,t,a){"use strict";a.r(t);a("T2oS");var n,r,o,i,l,c,s,p,d,u,m=a("W9HT"),h=(a("DZo9"),a("8z0m")),f=a("jehZ"),y=a.n(f),g=(a("+L6B"),a("2/Rp")),v=(a("Pwec"),a("CtXQ")),w=(a("6UJt"),a("DFOY")),E=(a("5NDa"),a("5rEg")),k=a("gWZ8"),C=a.n(k),D=a("p0pE"),S=a.n(D),T=(a("miYZ"),a("tsqr")),P=(a("/zsF"),a("PArb")),Y=a("2Taf"),x=a.n(Y),M=a("vZ4D"),b=a.n(M),I=a("l4Ni"),R=a.n(I),H=a("ujKo"),L=a.n(H),F=a("MhPg"),N=a.n(F),O=a("SQvw"),z=a.n(O),j=(a("y8nQ"),a("Vl3Y")),A=a("q1tI"),B=a.n(A),V=a("MuoO"),U=a("wd/R"),Q=a.n(U),q=a("UjoV"),G=a.n(q),J=a("fqkP"),Z=a.n(J),X=a("INpf"),K=a.n(X),W=(a("giR+"),a("fyUT")),$=(a("iQDF"),a("+eQT")),_=(a("OaEy"),a("2fM7")),ee=a("Odl4"),te=a.n(ee),ae=(_["a"].Option,function(e){function t(e){var a;return x()(this,t),a=R()(this,L()(t).call(this,e)),a.percentage=[{key:10,value:"10%"},{key:20,value:"20%"},{key:30,value:"30%"},{key:40,value:"40%"},{key:50,value:"50%"},{key:60,value:"60%"},{key:70,value:"70%"},{key:80,value:"80%"},{key:90,value:"90%"},{key:100,value:"100%"}],a.changeDate=function(e){var t=a.props,n=t.index,r=t.handleChangeDate;r(n,e)},a.isDisabledDate=function(e){},a.changeSelect=function(e){var t=a.props,n=t.index,r=t.handleChange;t.item;r(n,e)},a.clickAdd=function(){var e=a.props.handleAdd;e()},a.clickRemove=function(){var e=a.props,t=e.handleRemove,n=e.index;t(n)},a.state={},a}return N()(t,e),b()(t,[{key:"render",value:function(){var e=this.props,t=e.item,a=(e.index,e.showAdd),n=e.onlyOne;return B.a.createElement("div",{className:te.a.line},B.a.createElement("div",{style:{display:"flex"}},B.a.createElement("div",{className:te.a.item},B.a.createElement("span",{style:{display:"inline-block",width:56}},"\u65e5\u671f\uff1a"),B.a.createElement($["a"],{value:t.date,onChange:this.changeDate,disabledDate:this.isDisabledDate,style:{width:180},allowClear:!0})),B.a.createElement("div",null,"\u6bd4\u4f8b\uff1a",B.a.createElement(W["a"],{value:t.percentage,min:1,max:100,formatter:function(e){return"".concat(e,"%")},parser:function(e){return e.replace("%","")},onChange:this.changeSelect}))),n?"":B.a.createElement("div",{className:te.a.removeBtn},B.a.createElement(g["a"],{onClick:this.clickRemove,shape:"circle",icon:"minus",size:"small"})),a?B.a.createElement("div",{className:te.a.addBtn},B.a.createElement(g["a"],{onClick:this.clickAdd,type:"primary",shape:"circle",icon:"plus",size:"small"})):"")}}]),t}(A["Component"])),ne=(a("g9YV"),a("wCAj")),re=a("rlhR"),oe=a.n(re),ie=(a("2qtc"),a("kLXV")),le=ie["a"].confirm,ce=$["a"].RangePicker,se=(n=Object(V["connect"])(function(e){var t=e.home;return{historyList:t.historyList}}),n((o=function(e){function t(e){var a;return x()(this,t),a=R()(this,L()(t).call(this,e)),a.columns=[{title:"\u6587\u4ef6\u540d",dataIndex:"zipName",key:"zipName",render:function(e){return B.a.createElement("span",null,e)}},{title:"\u5bfc\u5165\u4eba",dataIndex:"importPeople",key:"importPeople",render:function(e){return B.a.createElement("span",null,e)}},{title:"\u521b\u5efa\u65e5\u671f",dataIndex:"createTime",key:"createTime",render:function(e){return B.a.createElement("span",null,Q()(new Date(Date.parse(e))).format("YYYY-MM-DD HH:mm:ss"))}},{title:"\u64cd\u4f5c",key:"action",render:function(e,t){return B.a.createElement("span",null,B.a.createElement("a",{href:"javascript:;",onClick:function(e){return a.download(t)}},"\u4e0b\u8f7d"),B.a.createElement(P["a"],{type:"vertical"}),B.a.createElement("a",{href:"javascript:;",onClick:function(e){return a.delItem(t)}},"\u5220\u9664"))}}],a.getHistoryData=function(){var e=a.props.dispatch,t=a.state,n=t.searchField,r=t.startTime,o=t.endTime,i=t.pagination,l=i.current,c=i.pageSize,s={importPeople:""===n?null:n,startTime:""===r?null:r,endTime:""===o?null:o,pageSize:c,pageIndex:l};e({type:"home/fetchHistory",payload:S()({},s)})},a.download=function(e){var t=a.props.dispatch;a.setState({modalLoading:!0}),t({type:"home/downItem",payload:{id:e.id}}).then(function(e){if(e instanceof Blob){var t=document.createElement("a"),n="\u8f66\u68c0\u62a5\u544a".concat(Q()(new Date).format("YYYY-MM-DD"));t.href=URL.createObjectURL(e),t.download="".concat(n,".zip"),t.style.display="none",document.body.appendChild(t),t.click(),t.remove()}a.setState({modalLoading:!1})})},a.delItem=function(e){var t=a.props.dispatch,n=oe()(a);le({title:"\u786e\u8ba4",content:"\u786e\u5b9a\u8981\u5220\u9664".concat(e.zipName,"\u5417\uff1f"),okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",centered:!0,onOk:function(){t({type:"home/delItem",payload:{id:e.id}}).then(function(e){"A00000"===e.code&&(T["a"].success("\u5220\u9664\u6210\u529f"),n.getHistoryData())})},onCancel:function(){}})},a.handleTableChange=function(e){a.setState({pagination:e},function(){a.getHistoryData()})},a.onChangeDate=function(e,t){a.setState({startTime:"".concat(t[0]," 00:00:00"),endTime:"".concat(t[1]," 23:59:59")})},a.changeSearchField=function(e){a.setState({searchField:e.currentTarget.value.trim()})},a.addOk=function(e){var t=a.props.toggleModal;t(),a.setState({startTime:null,endTime:null,searchField:void 0})},a.addCancel=function(){var e=a.props.toggleModal;e(),a.setState({startTime:null,endTime:null,searchField:void 0})},a.state={startTime:null,endTime:null,searchField:null,modalLoading:!1,pagination:{showTotal:function(e){return"\u5171".concat(e,"\u6761")},showSizeChanger:!0,showQuickJumper:!0,pageSize:10,current:1}},a}return N()(t,e),b()(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=this.props,a=t.showHistoryModal,n=t.historyList,r=this.state,o=r.pagination,i=r.searchField,l=r.modalLoading;return B.a.createElement(ie["a"],{title:"\u5386\u53f2\u6570\u636e",centered:!0,visible:a,onOk:this.addOk,onCancel:this.addCancel,destroyOnClose:!0,width:700},B.a.createElement(m["a"],{tip:"\u4e0b\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u540e...",spinning:l},B.a.createElement(ce,{onChange:function(t,a){return e.onChangeDate(t,a)},style:{marginBottom:20,marginRight:20}}),B.a.createElement(E["a"],{placeholder:"\u5bfc\u5165\u4eba",value:i,onChange:this.changeSearchField,style:{width:180,marginRight:20},allowClear:!0}),B.a.createElement(g["a"],{onClick:function(){return e.getHistoryData()},type:"primary"},"\u641c\u7d22"),B.a.createElement(ne["a"],{columns:this.columns,dataSource:n,rowKey:function(e){return e.id},pagination:o,onChange:this.handleTableChange,onShowSizeChange:this.handleTableChange})))}}]),t}(A["Component"]),r=o))||r),pe=se,de=(i=Object(V["connect"])(function(e){var t=e.home;return{cities:t.cities}}),l=j["a"].create(),c=G()(),s=Z()(2e3),i(p=l((u=function(e){function t(e){var a;return x()(this,t),a=R()(this,L()(t).call(this,e)),a.columns=[{title:"\u6587\u4ef6\u540d",dataIndex:"zipName",key:"zipName",render:function(e){return B.a.createElement("a",{href:"javascript:;"},e)}},{title:"\u5bfc\u5165\u4eba",dataIndex:"importPeople",key:"importPeople",render:function(e){return B.a.createElement("a",{href:"javascript:;"},e)}},{title:"\u521b\u5efa\u65e5\u671f",dataIndex:"createTime",key:"createTime",render:function(e){return B.a.createElement("span",null,Q()(new Date(Date.parse(e))).format("YYYY-MM-DD HH:mm:ss"))}},{title:"\u64cd\u4f5c",key:"action",render:function(e,t){return B.a.createElement("span",null,B.a.createElement("a",{href:"javascript:;",onClick:function(e){return a.download(t)}},"\u4e0b\u8f7d"),B.a.createElement(P["a"],{type:"vertical"}),B.a.createElement("a",{href:"javascript:;",onClick:function(e){return a.delItem(t)}},"\u5220\u9664"))}}],a.checkCity=function(){var e=a.state,t=e.city,n=e.importPeople;return n?t?void 0:(T["a"].warn("\u8bf7\u9009\u62e9\u57ce\u5e02"),!1):(T["a"].warn("\u8bf7\u586b\u5199\u5bfc\u5165\u4eba"),!1)},a.changeFile=function(e){var t=[];a.state.city?(t=[e.file],a.setState({uploadProps:S()({},a.state.uploadProps,{fileList:t})},function(){"done"===e.file.status?(T["a"].success("".concat(e.file.name," \u6587\u4ef6\u4e0a\u4f20\u6210\u529f")),a.setState({canExport:!0,hasGenerate:!1,uploadInfo:e.file.response.data.msg,reportVersion:e.file.response.data.reportVersion})):"error"===e.file.status&&T["a"].error("".concat(e.file.name," \u6587\u4ef6\u4e0a\u4f20\u5931\u8d25"))})):T["a"].error("\u8bf7\u9009\u62e9\u57ce\u5e02")},a.exportXls=function(){a.hasErrorInfo().then(function(){var e=a.props.dispatch;e({type:"home/export",payload:{}}).then(function(e){if(e instanceof Blob){var t=document.createElement("a"),a="\u9519\u8bef\u6570\u636e".concat(Q()(new Date).format("YYYY-MM-DD"));t.href=URL.createObjectURL(e),t.download="".concat(a,".xls"),t.style.display="none",document.body.appendChild(t),t.click(),t.remove()}})})},a.removeFile=function(e){a.setState({uploadProps:S()({},a.state.uploadProps,{fileList:[]}),uploadInfo:""})},a.getCities=function(){var e=a.props.dispatch;e({type:"home/fetchCities",payload:{}})},a.changeCity=function(e){a.setState({city:e.length?e:void 0,uploadProps:S()({},a.state.uploadProps,{data:{cityId:e,importPeople:a.state.importPeople}})})},a.changeImportPeople=function(e){var t=e.currentTarget.value.trim();a.setState({cityId:a.state.city,importPeople:t,uploadProps:S()({},a.state.uploadProps,{data:{cityId:a.state.city,importPeople:t}})})},a.isFull=function(){var e=0;return a.state.arr.forEach(function(t){e+=t.percentage}),e>=100},a.changeIsFull=function(e,t){var n=0;return a.state.arr.forEach(function(a,r){n+=e===r?t:a.percentage}),n>100},a.addArr=function(){a.isFull()?T["a"].warn("\u6bd4\u4f8b\u8d85\u51fa100%"):a.setState({arr:[].concat(C()(a.state.arr),[{date:null,percentage:1}])})},a.removeArr=function(e){var t=a.state.arr;1!==t.length&&(t.splice(e,1),a.setState({arr:t}))},a.changePer=function(e,t){if(a.changeIsFull(e,t))T["a"].warn("\u6bd4\u4f8b\u8d85\u51fa100%");else{var n=a.state.arr;n[e].percentage=t,a.setState({arr:n})}},a.hasDate=function(e){return a.state.arr.find(function(t){return Q()(t.date).format("YYYY:MM:DD")===Q()(e).format("YYYY:MM:DD")})},a.changDate=function(e,t){if(a.hasDate(t))T["a"].warn("\u65e5\u671f\u5df2\u5b58\u5728");else{var n=a.state.arr;n[e].date=t,a.setState({arr:n})}},a.validate=function(){var e=a.state.arr.find(function(e){return!e.date});if(e)return T["a"].warn("\u8bf7\u586b\u5199\u65e5\u671f"),!1;var t=a.isFull();return!!t||(T["a"].warn("\u6bd4\u4f8b\u4e0d\u8db3100%"),!1)},a.toReport=function(){if(a.validate()){a.setState({loading:!0});var e=a.props.dispatch,t=a.state.arr.map(function(e){return{checkTime:Q()(e.date).format("YYYY-MM-DD"),proportion:e.percentage}});e({type:"home/generateReport",payload:{checkReportRequestList:t,reportVersion:a.state.reportVersion}}).then(function(e){"A00000"===e.code&&(T["a"].success("\u5df2\u751f\u6210\u62a5\u544a"),a.setState({hasGenerate:!0,reportVersion:e.data.reportVersion})),a.setState({loading:!1})})}},a.getHistoryListInit=function(){var e=a.props.dispatch,t={importPeople:null,startTime:null,endTime:null,pageSize:10,pageIndex:1};e({type:"home/fetchHistory",payload:S()({},t)})},a.toggleHistoryModal=function(){a.state.showHistoryModal;a.setState({showHistoryModal:!a.state.showHistoryModal})},a.state={city:void 0,hasGenerate:!1,canExport:!1,loading:!1,spanTip:"",disabledBtn:!1,uploadInfo:"",uploadProps:{name:"file",accept:".csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",action:"http://test.report.ely.work/api/report/importPolicyNoOrder",fileList:[],data:{cityId:null,importPeople:null}},arr:[{date:null,percentage:1}],showHistoryModal:!1,importPeople:null,startTime:null,endTime:null,searchField:null,pagination:{showTotal:function(e){return"\u5171".concat(e,"\u6761")},showSizeChanger:!0,showQuickJumper:!0,pageSize:10,current:1}},a}return N()(t,e),b()(t,[{key:"componentDidMount",value:function(){this.getCities()}},{key:"downReport",value:function(){var e=this,t=this.props.dispatch;this.setState({loading:!0,disabledBtn:!0,spanTip:"\u4e0b\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u540e..."},function(){t({type:"home/downloadReport",payload:{importPeople:e.state.importPeople,reportVersion:e.state.reportVersion}}).then(function(t){if(e.setState({loading:!1,disabledBtn:!1,spanTip:"",hasGenerate:!1}),t instanceof Blob){var a=document.createElement("a"),n="\u8f66\u68c0\u62a5\u544a".concat(Q()(new Date).format("YYYY-MM-DD"));a.href=URL.createObjectURL(t),a.download="".concat(n,".zip"),a.style.display="none",document.body.appendChild(a),a.click(),a.remove()}location.reload()})})}},{key:"hasErrorInfo",value:function(){var e=this;return new Promise(function(t){var a=e.props.dispatch;a({type:"home/hasErrorInfo",payload:{}}).then(function(e){"A00003"===e.code&&T["a"].warn(e.msg),"A00000"===e.code&&t(!0)})})}},{key:"showHistory",value:function(){var e=this;this.setState({showHistoryModal:!0},function(){e.getHistoryListInit()})}},{key:"render",value:function(){var e=this,t=this.props,a=t.cities,n=(t.historyList,t.form.getFieldDecorator,this.state),r=n.fileList,o=n.uploadProps,i=n.arr,l=n.hasGenerate,c=n.city,s=n.canExport,p=n.loading,d=n.disabledBtn,u=n.spanTip,f=n.uploadInfo,k=n.showHistoryModal,C=n.importPeople;return B.a.createElement(m["a"],{spinning:p,delay:500,tip:u},B.a.createElement("div",{className:K.a.content},B.a.createElement("div",{style:{marginLeft:200,width:800}},B.a.createElement("div",{style:{marginBottom:10,width:"74%",fontSize:13,color:"red"}},f),B.a.createElement(j["a"],null,B.a.createElement("div",{className:K.a.line,style:{width:800}},B.a.createElement("div",{className:K.a.item,style:{position:"relative"}},B.a.createElement("span",{style:{position:"absolute",top:6,left:-8,color:"red",marginRight:4}},"*"),"\u5bfc\u5165\u4eba\uff1a",B.a.createElement(E["a"],{placeholder:"\u8bf7\u8f93\u5165",value:C,onChange:this.changeImportPeople,style:{width:180},allowClear:!0})),B.a.createElement("div",{className:K.a.item,style:{position:"relative"}},B.a.createElement("span",{style:{position:"absolute",top:6,left:-8,color:"red",marginRight:4}},"*"),"\u57ce\u5e02\uff1a",B.a.createElement(w["a"],{fieldNames:{label:"cityName",value:"id",children:"items"},options:a,value:c,onChange:this.changeCity,placeholder:"\u9009\u62e9\u57ce\u5e02",style:{width:180},allowClear:!0})),B.a.createElement("div",{style:{position:"relative",width:225}},B.a.createElement(h["a"],y()({disabled:void 0===c||""===C,fileList:r,onChange:this.changeFile,onRemove:this.removeFile},o),B.a.createElement(g["a"],{onClick:function(){return e.checkCity()}},B.a.createElement(v["a"],{type:"upload"})," \u4e0a\u4f20\u6587\u4ef6")),s?B.a.createElement("span",{style:{position:"absolute",top:0,right:-23}},B.a.createElement(g["a"],{onClick:this.exportXls,type:"primary"},"\u4e0b\u8f7d\u9519\u8bef\u6570\u636e")):""))),i.map(function(t,a){return B.a.createElement(ae,{item:t,index:a,handleChangeDate:e.changDate,handleChange:e.changePer,handleAdd:e.addArr,handleRemove:e.removeArr,showAdd:i.length-1===a,onlyOne:1===i.length,key:a.toString()})}),B.a.createElement("div",{className:K.a.line},B.a.createElement("div",{style:{marginTop:20,marginRight:20}},B.a.createElement(g["a"],{onClick:function(){return e.showHistory()},type:"primary"},"\u5386\u53f2\u62a5\u544a")),B.a.createElement("div",{style:{width:"100%",display:"flex",justifyContent:"flex-end",marginTop:20}},l?B.a.createElement(g["a"],{disabled:d,onClick:function(){return e.downReport()},type:"primary"},"\u4e0b\u8f7d\u62a5\u544a"):B.a.createElement(g["a"],{onClick:this.toReport,type:"primary"},"\u751f\u6210\u62a5\u544a"))))),B.a.createElement(pe,{showHistoryModal:k,toggleModal:function(){return e.toggleHistoryModal()}}))}}]),t}(A["Component"]),d=u,z()(d.prototype,"downReport",[c,s],Object.getOwnPropertyDescriptor(d.prototype,"downReport"),d.prototype),p=d))||p)||p);t["default"]=de}}]);